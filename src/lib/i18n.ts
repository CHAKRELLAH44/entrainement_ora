"use client";
import { useState, useEffect } from "react";

export type Lang = "fr" | "en" | "es";

const LANG_KEY = "userLang";

export function getUserLang(): Lang {
  if (typeof window === "undefined") return "fr";
  return (localStorage.getItem(LANG_KEY) as Lang) || "fr";
}

export function setUserLang(lang: Lang): void {
  localStorage.setItem(LANG_KEY, lang);
  window.dispatchEvent(new Event("langchange"));
}

export function getLangTTSCode(lang: Lang): string {
  switch (lang) {
    case "en": return "en-US";
    case "es": return "es-ES";
    default: return "fr-FR";
  }
}

export function getLangFlag(lang: Lang): string {
  switch (lang) {
    case "en": return "ðŸ‡¬ðŸ‡§";
    case "es": return "ðŸ‡ªðŸ‡¸";
    default: return "ðŸ‡«ðŸ‡·";
  }
}

export function getLangLabel(lang: Lang): string {
  switch (lang) {
    case "en": return "English";
    case "es": return "Espanol";
    default: return "Francais";
  }
}

// Hook
export function useLang() {
  const [lang, setLang] = useState<Lang>("fr");

  useEffect(() => {
    setLang(getUserLang());
    const handler = () => setLang(getUserLang());
    window.addEventListener("langchange", handler);
    return () => window.removeEventListener("langchange", handler);
  }, []);

  function t(key: keyof typeof TRANSLATIONS.fr): string {
    return TRANSLATIONS[lang]?.[key] || TRANSLATIONS.fr[key] || key;
  }

  return { lang, t };
}

// Traductions
export const TRANSLATIONS = {
  fr: {
    appName: "Parole Libre",
    hello: "Bonjour",
    whatToDo: "Que veux-tu faire aujourd hui ?",
    speak: "Parler",
    read: "Lire",
    available: "Disponible",
    alwaysAvailable: "Toujours disponible",
    lockedHours: "h restantes",
    mySessions: "Mes seances",
    logout: "Deconnexion",
    settings: "Parametres",
    language: "Langue",
    changeLanguage: "Changer de langue",
    comingSoon: "D autres features arrivent bientot. Stay tuned",
    newFeature: "Nouvelle feature",
    readingModule: "Module de lecture",
    oralUnavailable: "Partie orale indisponible",
    comeBackIn: "Reviens dans",
    hours: "heure",
    hours2: "heures",
    canRead: "Tu peux lire en attendant !",
    streakDays: "jour",
    streakDays2: "jours",
    streakSuffix: "de suite !",
    loginTitle: "Connexion",
    loginPlaceholder: "Ton prenom...",
    loginBtn: "Continuer",
    rollTopic: "Lancer le de",
    thinkTime: "Temps de reflexion",
    speakTime: "Temps de parole",
    start: "Demarrer",
    topicLabel: "Sujet du jour",
    recording: "Enregistrement en cours",
    reviewTitle: "Bilan",
    howDidItGo: "Comment ca s est passe ?",
    validate: "Valider",
    savingTitle: "Sauvegarde",
    sending: "Analyse et sauvegarde en cours...",
    doneTitle: "Termine",
    whatYouSaid: "Ce que tu as dit",
    seeCorrection: "Voir la correction",
    correctedText: "Texte corrige",
    sessionSaved: "Seance enregistree !",
    seeMySessions: "Voir mes seances",
    backHome: "Retour a l accueil",
    average: "Moyenne",
    sessions: "Seances",
    best: "Meilleure",
    noSessions: "Aucune seance pour l instant. Lance-toi !",
    begin: "Commencer",
    deleteAll: "Effacer toutes mes seances",
    confirmDelete: "Confirmer la suppression ?",
    yes: "Oui, effacer",
    cancel: "Annuler",
    library: "Bibliotheque",
    history: "Historique",
    books: "Livres",
    chooseBook: "Choisis un livre et commence ta lecture.",
    finishToUnlock: "Termine un livre + ecris ton bilan pour debloquer le suivant.",
    clickWord: "Appuie sur un mot pour entendre sa prononciation",
    pronounceWord: "Prononcer le mot",
    pronounceSentence: "Prononcer la phrase",
    close: "Fermer",
    previousChapter: "Precedent",
    nextChapter: "Chapitre suivant",
    finishBook: "Terminer le livre",
    saveQuit: "Sauvegarder et quitter",
    progressSaved: "Progression sauvegardee",
    readingReview: "Bilan de lecture",
    yourSummary: "Ton resume (minimum 100 mots)",
    summaryPlaceholder: "Qu est-ce que tu as appris de cette lecture ?",
    words100: "mots minimum",
    sufficient: "Suffisant",
    twoWords: "2 nouveaux mots appris",
    word: "Mot",
    wordDefinition: "Sa definition...",
    correctWithAI: "Corriger avec IA",
    whatYouWrote: "Ce que tu as ecrit",
    correctedSummary: "Resume corrige",
    yourWords: "Tes mots appris",
    correct: "Correct",
    toReview: "A revoir",
    validateFinish: "Valider et terminer",
    modifySummary: "Modifier mon resume",
    next: "Suivant",
    back: "Retour",
    startSession: "Commencer la seance",
    locked: "Verrouille",
    unlockPrev: "Termine le livre precedent pour debloquer",
    inProgress: "En cours",
    toEvaluate: "A evaluer",
    finished: "Termine",
    writeSummary: "Ecris ton resume pour debloquer le suivant !",
    seenCorrection: "Voir la correction",
    seeWords: "Voir les mots appris",
    hide: "Masquer",
    correctionIA: "Correction IA",
  },
  en: {
    appName: "Free Speech",
    hello: "Hello",
    whatToDo: "What do you want to do today?",
    speak: "Speak",
    read: "Read",
    available: "Available",
    alwaysAvailable: "Always available",
    lockedHours: "h remaining",
    mySessions: "My sessions",
    logout: "Logout",
    settings: "Settings",
    language: "Language",
    changeLanguage: "Change language",
    comingSoon: "More features coming soon. Stay tuned",
    newFeature: "New feature",
    readingModule: "Reading module",
    oralUnavailable: "Speaking session unavailable",
    comeBackIn: "Come back in",
    hours: "hour",
    hours2: "hours",
    canRead: "You can read in the meantime!",
    streakDays: "day",
    streakDays2: "days",
    streakSuffix: "in a row!",
    loginTitle: "Login",
    loginPlaceholder: "Your first name...",
    loginBtn: "Continue",
    rollTopic: "Roll the dice",
    thinkTime: "Thinking time",
    speakTime: "Speaking time",
    start: "Start",
    topicLabel: "Today's topic",
    recording: "Recording...",
    reviewTitle: "Review",
    howDidItGo: "How did it go?",
    validate: "Submit",
    savingTitle: "Saving",
    sending: "Analyzing and saving...",
    doneTitle: "Done",
    whatYouSaid: "What you said",
    seeCorrection: "See correction",
    correctedText: "Corrected text",
    sessionSaved: "Session saved!",
    seeMySessions: "See my sessions",
    backHome: "Back to home",
    average: "Average",
    sessions: "Sessions",
    best: "Best",
    noSessions: "No sessions yet. Get started!",
    begin: "Start",
    deleteAll: "Delete all my sessions",
    confirmDelete: "Confirm deletion?",
    yes: "Yes, delete",
    cancel: "Cancel",
    library: "Library",
    history: "History",
    books: "Books",
    chooseBook: "Choose a book and start reading.",
    finishToUnlock: "Finish a book + write your review to unlock the next one.",
    clickWord: "Tap a word to hear its pronunciation",
    pronounceWord: "Pronounce the word",
    pronounceSentence: "Pronounce the sentence",
    close: "Close",
    previousChapter: "Previous",
    nextChapter: "Next chapter",
    finishBook: "Finish the book",
    saveQuit: "Save and quit",
    progressSaved: "Progress saved",
    readingReview: "Reading review",
    yourSummary: "Your summary (minimum 100 words)",
    summaryPlaceholder: "What did you learn from this reading?",
    words100: "words minimum",
    sufficient: "Sufficient",
    twoWords: "2 new words learned",
    word: "Word",
    wordDefinition: "Its definition...",
    correctWithAI: "Correct with AI",
    whatYouWrote: "What you wrote",
    correctedSummary: "Corrected summary",
    yourWords: "Your learned words",
    correct: "Correct",
    toReview: "To review",
    validateFinish: "Validate and finish",
    modifySummary: "Edit my summary",
    next: "Next",
    back: "Back",
    startSession: "Start session",
    locked: "Locked",
    unlockPrev: "Finish the previous book to unlock",
    inProgress: "In progress",
    toEvaluate: "To evaluate",
    finished: "Finished",
    writeSummary: "Write your review to unlock the next book!",
    seenCorrection: "See correction",
    seeWords: "See learned words",
    hide: "Hide",
    correctionIA: "AI Correction",
  },
  es: {
    appName: "Habla Libre",
    hello: "Hola",
    whatToDo: "Que quieres hacer hoy?",
    speak: "Hablar",
    read: "Leer",
    available: "Disponible",
    alwaysAvailable: "Siempre disponible",
    lockedHours: "h restantes",
    mySessions: "Mis sesiones",
    logout: "Cerrar sesion",
    settings: "Ajustes",
    language: "Idioma",
    changeLanguage: "Cambiar idioma",
    comingSoon: "Mas funciones proximamente. Stay tuned",
    newFeature: "Nueva funcion",
    readingModule: "Modulo de lectura",
    oralUnavailable: "Sesion oral no disponible",
    comeBackIn: "Vuelve en",
    hours: "hora",
    hours2: "horas",
    canRead: "Puedes leer mientras tanto!",
    streakDays: "dia",
    streakDays2: "dias",
    streakSuffix: "seguidos!",
    loginTitle: "Iniciar sesion",
    loginPlaceholder: "Tu nombre...",
    loginBtn: "Continuar",
    rollTopic: "Lanzar el dado",
    thinkTime: "Tiempo de reflexion",
    speakTime: "Tiempo de habla",
    start: "Empezar",
    topicLabel: "Tema del dia",
    recording: "Grabando...",
    reviewTitle: "Balance",
    howDidItGo: "Como fue?",
    validate: "Validar",
    savingTitle: "Guardando",
    sending: "Analizando y guardando...",
    doneTitle: "Terminado",
    whatYouSaid: "Lo que dijiste",
    seeCorrection: "Ver correccion",
    correctedText: "Texto corregido",
    sessionSaved: "Sesion guardada!",
    seeMySessions: "Ver mis sesiones",
    backHome: "Volver al inicio",
    average: "Promedio",
    sessions: "Sesiones",
    best: "Mejor",
    noSessions: "Sin sesiones por ahora. Empieza!",
    begin: "Empezar",
    deleteAll: "Borrar todas mis sesiones",
    confirmDelete: "Confirmar eliminacion?",
    yes: "Si, borrar",
    cancel: "Cancelar",
    library: "Biblioteca",
    history: "Historial",
    books: "Libros",
    chooseBook: "Elige un libro y empieza a leer.",
    finishToUnlock: "Termina un libro + escribe tu resumen para desbloquear el siguiente.",
    clickWord: "Toca una palabra para escuchar su pronunciacion",
    pronounceWord: "Pronunciar la palabra",
    pronounceSentence: "Pronunciar la frase",
    close: "Cerrar",
    previousChapter: "Anterior",
    nextChapter: "Siguiente capitulo",
    finishBook: "Terminar el libro",
    saveQuit: "Guardar y salir",
    progressSaved: "Progreso guardado",
    readingReview: "Resumen de lectura",
    yourSummary: "Tu resumen (minimo 100 palabras)",
    summaryPlaceholder: "Que aprendiste de esta lectura?",
    words100: "palabras minimo",
    sufficient: "Suficiente",
    twoWords: "2 nuevas palabras aprendidas",
    word: "Palabra",
    wordDefinition: "Su definicion...",
    correctWithAI: "Corregir con IA",
    whatYouWrote: "Lo que escribiste",
    correctedSummary: "Resumen corregido",
    yourWords: "Tus palabras aprendidas",
    correct: "Correcto",
    toReview: "A revisar",
    validateFinish: "Validar y terminar",
    modifySummary: "Editar mi resumen",
    next: "Siguiente",
    back: "Atras",
    startSession: "Empezar sesion",
    locked: "Bloqueado",
    unlockPrev: "Termina el libro anterior para desbloquear",
    inProgress: "En curso",
    toEvaluate: "A evaluar",
    finished: "Terminado",
    writeSummary: "Escribe tu resumen para desbloquear el siguiente libro!",
    seenCorrection: "Ver correccion",
    seeWords: "Ver palabras aprendidas",
    hide: "Ocultar",
    correctionIA: "Correccion IA",
  },
};